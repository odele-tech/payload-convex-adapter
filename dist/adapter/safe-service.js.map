{"version":3,"sources":["../../src/adapter/safe-service.ts"],"names":[],"mappings":";;;;AAqFO,SAAS,+BACd,KAAA,EACA;AACA,EAAA,MAAM,EAAE,OAAA,EAAS,MAAA,EAAQ,SAAA,EAAU,GAAI,KAAA;AAEvC,EAAA,MAAM,aAAA,GAAgB,mBAAA,CAAoB,EAAE,MAAA,EAAQ,CAAA;AACpD,EAAA,MAAM,iBAAiB,oBAAA,EAAqB;AAE5C,EAAA,MAAM,MAAA,GAAS;AAAA,IACb,GAAA,EAAK,SAAA;AAAA,IACL,MAAA;AAAA,IACA,MAAA,EAAQ,aAAA;AAAA,IACR,KAAA;AAAA,IACA;AAAA,GACF;AAEA,EAAA,MAAM,EAAA,GAAK;AAAA,IACT,KAAA,EAAO,YAAA;AAAA,IACP,QAAA,EAAU,eAAA;AAAA,IACV,QAAA,EAAU;AAAA,GACZ;AAEA,EAAA,MAAM,KAAA,GAAQ;AAAA,IACZ,cAAA;AAAA,IACA,cAAA;AAAA,IACA,eAAA;AAAA,IACA,cAAA;AAAA,IACA,eAAA;AAAA,IACA;AAAA,GACF;AAEA,EAAA,OAAO;AAAA,IACL,EAAA;AAAA,IACA,KAAA;AAAA,IACA,MAAA;AAAA,IACA;AAAA,GACF;AACF","file":"safe-service.js","sourcesContent":["/**\n * @fileoverview Convex-Safe Adapter Service Factory\n *\n * This module provides a \"safe\" version of the adapter service that can be used\n * within Convex functions. Unlike the standard adapter service, this version\n * does not include the Convex HTTP client, making it safe to import and use\n * inside Convex server functions without circular dependency issues.\n *\n * ## Use Cases\n * - Server-side Convex functions../convex/mutation-adapter/querieser utilities\n * - Convex actions that need to parse Payload where clauses\n * - Internal Convex mutations that need collection name parsing\n *\n * ## Differences from AdapterService\n * - No `db.client` property (no ConvexHttpClient or ConvexClient)\n * - No `db.api` property (no anyApi reference)\n * - Safe to use within Convex function handlers\n *\n * @module adapter/convex-safe-service\n */\n\nimport { Payload } from \"payload\";\n\nimport { QueryAdapter } from \"../convex/queries\";\nimport { MutationAdapter } from \"../convex/mutations\";\nimport * as bindings from \"../bindings\";\nimport { createServiceLogger } from \"../tools/logger\";\nimport { isDev } from \"../tools/is-dev\";\nimport { isClient } from \"../tools/is-client\";\nimport { createRandomID } from \"../tools/random\";\nimport { parseCollection } from \"../tools/parse-collection\";\nimport { queryProcessor } from \"../tools/query-processor\";\nimport { createWherePlan, emptyWherePlan } from \"../tools/query-processor\";\nimport { createSessionTracker } from \"../tools/session-tracker\";\n\n/**\n * Configuration props for creating a Convex-safe adapter service.\n */\nexport type ConvexSafeAdapterServiceProps = {\n  /** The Convex deployment URL */\n  convexUrl: string;\n  /** The Convex deployment identifier */\n  convexDeployment: string;\n  /** The table name prefix for this adapter instance */\n  prefix: string;\n  /** The Payload instance this service is associated with */\n  payload: Payload;\n};\n\n/**\n * The Convex-safe adapter service type.\n * This type represents the service object without Convex client dependencies.\n */\nexport type ConvexSafeAdapterService = ReturnType<\n  typeof createConvexSafeAdapterService\n>;\n\n/**\n * Creates a Convex-safe adapter service instance.\n *\n * This factory creates a service that can be safely used within Convex functions.\n * It provides access to query/mutation adapters and utility functions without\n * including the Convex client, which would cause issues when imported inside\n * Convex server functions.\n *\n * @param {ConvexSafeAdapterServiceProps} props - Configuration options\n * @returns {ConvexSafeAdapterService} The configured Convex-safe adapter service\n *\n * @example\n * ```typescript\n * // Inside a Convex function\n * const service = createConvexSafeAdapterService({\n *   convexUrl: 'https://your-deployment.convex.cloud',\n *   convexDeployment: 'dev:your-deployment',\n *   prefix: 'my_app',\n *   payload: payloadInstance,\n * });\n *\n * // Parse a collection name\n * const collectionId = service.tools.parseCollection({\n *   prefix: service.system.prefix,\n *   collection: 'users',\n * });\n * ```\n */\nexport function createConvexSafeAdapterService(\n  props: ConvexSafeAdapterServiceProps\n) {\n  const { payload, prefix, convexUrl } = props;\n\n  const serviceLogger = createServiceLogger({ prefix });\n  const sessionTracker = createSessionTracker();\n\n  const system = {\n    url: convexUrl,\n    prefix: prefix,\n    logger: serviceLogger,\n    isDev,\n    isClient,\n  };\n\n  const db = {\n    query: QueryAdapter,\n    mutation: MutationAdapter,\n    bindings: bindings,\n  };\n\n  const tools = {\n    sessionTracker,\n    createRandomID,\n    parseCollection,\n    queryProcessor,\n    createWherePlan,\n    emptyWherePlan,\n  };\n\n  return {\n    db,\n    tools,\n    system,\n    payload,\n  };\n}\n"]}
{"version":3,"sources":["../src/adapter/service.ts","../src/adapter/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["/**\n * @fileoverview Adapter Service Factory\n *\n * This module provides the core service layer for the Convex adapter. The adapter\n * service encapsulates all dependencies and utilities needed for database operations,\n * including the Convex client, session tracking, and query/mutation adapters.\n *\n * ## Service Structure\n * The service is organized into four main sections:\n * - `db`: Database client and operation adapters\n * - `tools`: Utility functions (ID generation, session tracking, etc.)\n * - `system`: Configuration values (URL, prefix)\n * - `payload`: Reference to the Payload instance\n *\n * @module adapter/service\n */\n\nimport { Payload } from \"payload\";\nimport { GenericDataModel, anyApi } from \"convex/server\";\n\nimport { QueryAdapter, MutationAdapter, createConvexClient } from \"../convex\";\n\nimport {\n  createRandomID,\n  createSessionTracker,\n  createServiceLogger,\n  isDev,\n  isClient,\n  queryProcessor,\n  parseCollection,\n  createWherePlan,\n  emptyWherePlan,\n} from \"../tools\";\n\nimport * as bindings from \"../bindings\";\n\n/**\n * Configuration props for creating an adapter service.\n *\n * @template T - The Convex data model type\n */\nexport type AdapterServiceProps<T extends GenericDataModel> = {\n  /** The Convex deployment URL */\n  convexUrl: string;\n  /** The Convex deployment identifier */\n  convexDeployment: string;\n  /** The table name prefix for this adapter instance */\n  prefix: string;\n  /** The Payload instance this service is associated with */\n  payload: Payload;\n};\n\n/**\n * The adapter service type, inferred from the factory function return type.\n * This type represents the complete service object with all its properties and methods.\n *\n * @template T - The Convex data model type\n */\nexport type AdapterService<T extends GenericDataModel = GenericDataModel> =\n  ReturnType<typeof createAdapterService<T>>;\n\n/**\n * Creates an adapter service instance with all required dependencies.\n *\n * The adapter service is the central coordination point for all database operations.\n * It provides access to:\n * - The Convex client for direct database access\n * - Query and mutation adapters for type-safe operations\n * - Utility functions for ID generation and collection parsing\n * - Session tracking for transaction management\n *\n * @template T - The Convex data model type\n * @param {AdapterServiceProps<T>} props - Configuration options\n * @returns {AdapterService<T>} The configured adapter service\n *\n * @example\n * ```typescript\n * const service = createAdapterService({\n *   convexUrl: 'https://your-deployment.convex.cloud',\n *   convexDeployment: 'dev:your-deployment',\n *   prefix: 'my_app',\n *   payload: payloadInstance,\n * });\n *\n * // Use the service for database operations\n * const docs = await service.db.query({}).collectionQuery.adapter({\n *   service,\n *   collection: 'users',\n *   index: null,\n * });\n * ```\n */\nexport function createAdapterService<T extends GenericDataModel>(\n  props: AdapterServiceProps<T>\n) {\n  const { payload, prefix, convexUrl } = props;\n\n  const convexClient = createConvexClient({ convexUrl });\n  const serviceLogger = createServiceLogger({ prefix });\n  const sessionTracker = createSessionTracker();\n\n  // Version tracking context for coordinating version creation and cleanup\n  let recentVersionId: string | undefined;\n\n  const system = {\n    url: convexUrl,\n    prefix: prefix,\n    logger: serviceLogger,\n    isDev,\n    isClient,\n    /**\n     * Sets the ID of a recently created version to protect it from cleanup.\n     * This is used to coordinate between createVersion and deleteVersions operations.\n     */\n    setRecentVersionId: (id: string) => {\n      recentVersionId = id;\n    },\n    /**\n     * Gets the ID of the recently created version, if any.\n     * Returns undefined if no version was recently created.\n     */\n    getRecentVersionId: () => recentVersionId,\n    /**\n     * Clears the recent version ID after cleanup is complete.\n     */\n    clearRecentVersionId: () => {\n      recentVersionId = undefined;\n    },\n  };\n\n  const db = {\n    client: convexClient,\n    bindings: bindings,\n    query: QueryAdapter,\n    mutation: MutationAdapter,\n    api: anyApi,\n  };\n\n  const tools = {\n    sessionTracker,\n    createRandomID,\n    queryProcessor,\n    parseCollection,\n    createWherePlan,\n    emptyWherePlan,\n  };\n\n  return {\n    db,\n    tools,\n    system,\n    payload,\n  };\n}\n","/**\n * @fileoverview Convex Database Adapter Factory\n *\n * This module provides the main database adapter factory for integrating Convex\n * with Payload CMS. It implements Payload's `DatabaseAdapterObj` interface,\n * providing all required database operations.\n *\n * ## Architecture\n * The adapter uses a service-based architecture where:\n * - The adapter factory creates the database adapter configuration\n * - The adapter service manages the Convex client and utilities\n * - Bindings provide the actual database operation implementations\n *\n * ## Collection Naming\n * Collections are prefixed with the configured prefix to support multi-tenant\n * deployments and avoid naming conflicts. For example, with prefix \"my_app\",\n * a collection \"users\" becomes \"my_app_users\" in Convex.\n *\n * @module adapter\n */\n\nimport {\n  type BaseDatabaseAdapter,\n  type Payload,\n  type DatabaseAdapterObj,\n  type TypeWithID,\n  type JsonObject,\n  type TypeWithVersion,\n  type PaginatedDocs,\n  type CreateGlobal,\n  type CreateVersion,\n  type CreateGlobalVersion,\n  type UpdateGlobal,\n  type UpdateVersion,\n  type UpdateGlobalVersion,\n  createDatabaseAdapter,\n} from \"payload\";\n\nimport { createAdapterService } from \"./service\";\n\n/**\n * Configuration options for the Convex adapter.\n * These settings determine how the adapter connects to and interacts with Convex.\n */\nexport type PayloadConvexConfig = {\n  /**\n   * The Convex deployment URL.\n   * This is the HTTPS URL of your Convex deployment.\n   * @example \"https://valuable-salamander-162.convex.cloud\"\n   */\n  convexUrl: string;\n  /**\n   * The Convex deployment identifier.\n   * Format: \"environment:deployment-name\"\n   * @example \"dev:valuable-salamander-162\"\n   */\n  convexDeployment: string;\n  /**\n   * The prefix to use for all Convex table names.\n   * This enables multiple Payload instances to share a Convex deployment.\n   * @example \"my_app\"\n   */\n  prefix: string;\n};\n\n/**\n * Props type for the convexAdapter factory function.\n * Alias for PayloadConvexConfig for clarity in function signatures.\n */\nexport type PayloadConvexAdapterProps = PayloadConvexConfig;\n\n/**\n * Type definition for the Convex database adapter.\n * Implements Payload's DatabaseAdapterObj interface with BaseDatabaseAdapter.\n */\nexport type convexAdapter = DatabaseAdapterObj<BaseDatabaseAdapter>;\n\n/**\n * Creates a Payload database adapter that uses Convex as the backend.\n *\n * This factory function returns a database adapter configuration object that\n * Payload uses to initialize the database connection. The adapter implements\n * all required Payload database operations including CRUD, transactions,\n * versioning, and migrations.\n *\n * @param {PayloadConvexAdapterProps} props - Configuration options for the adapter\n * @returns {convexAdapter} A Payload database adapter object\n *\n * @example\n * ```typescript\n * import { convexAdapter } from 'payload-convex-adapter';\n *\n * const adapter = convexAdapter({\n *   convexUrl: process.env.CONVEX_URL,\n *   convexDeployment: process.env.CONVEX_DEPLOYMENT,\n *   prefix: 'my_app',\n * });\n * ```\n */\nexport function convexAdapter(props: PayloadConvexAdapterProps) {\n  return {\n    name: \"payload-convex-adapter\",\n    allowIDOnCreate: false,\n    defaultIDType: \"text\",\n    init: (args: { payload: Payload }) => {\n      const { payload } = args;\n\n      const service = createAdapterService({\n        ...props,\n        payload,\n      });\n\n      return createDatabaseAdapter({\n        payload,\n        name: \"payload-convex\",\n        packageName: \"payload-convex-adapter\",\n        defaultIDType: \"text\",\n        migrationDir: \"./migrations\",\n\n        // Transaction Bindings\n        beginTransaction: async () => {\n          return await service.db.bindings.transactions.beginTransaction({\n            service: service,\n          });\n        },\n        commitTransaction: async (id) => {\n          return await service.db.bindings.transactions.commitTransaction({\n            service: service,\n            incomingID: id,\n          });\n        },\n        rollbackTransaction: async (id) => {\n          return await service.db.bindings.transactions.rollbackTransaction({\n            service: service,\n            incomingID: id,\n          });\n        },\n\n        // Counts\n        count: async (countProps) => {\n          return await service.db.bindings.counts.count({\n            service: service,\n            incomingCount: countProps,\n          });\n        },\n\n        countVersions: async (countVersionsProps) => {\n          return await service.db.bindings.counts.countVersions({\n            service: service,\n            incomingCountVersions: countVersionsProps,\n          });\n        },\n\n        countGlobalVersions: async (countGlobalVersionsProps) => {\n          return await service.db.bindings.counts.countGlobalVersions({\n            service: service,\n            incomingCountGlobalVersions: countGlobalVersionsProps,\n          });\n        },\n\n        // Create\n        create: async (createProps) => {\n          return await service.db.bindings.creates.create({\n            service: service,\n            incomingCreate: createProps,\n          });\n        },\n\n        createGlobal: (async (createGlobalProps) => {\n          return await service.db.bindings.creates.createGlobal({\n            service: service,\n            incomingCreateGlobal: createGlobalProps,\n          });\n        }) as CreateGlobal,\n\n        createVersion: (async (createVersionProps) => {\n          return await service.db.bindings.creates.createVersion({\n            service: service,\n            incomingCreateVersion: createVersionProps,\n          });\n        }) as CreateVersion,\n\n        createGlobalVersion: (async (createGlobalVersionProps) => {\n          return await service.db.bindings.creates.createGlobalVersion({\n            service: service,\n            incomingCreateGlobalVersion: createGlobalVersionProps,\n          });\n        }) as CreateGlobalVersion,\n\n        createMigration: async (createMigrationProps) => {\n          return await service.db.bindings.creates.createMigration({\n            service: service,\n            incomingCreateMigration: createMigrationProps,\n          });\n        },\n\n        // Find\n        find: async (findProps) => {\n          return (await service.db.bindings.finds.find({\n            service: service,\n            incomingFind: findProps,\n          })) as any;\n        },\n\n        findOne: async (findOneProps) => {\n          return (await service.db.bindings.finds.findOne({\n            service: service,\n            incomingFindOne: findOneProps,\n          })) as any;\n        },\n\n        findDistinct: async (findDistinctProps) => {\n          return (await service.db.bindings.finds.findDistinct({\n            service: service,\n            incomingFindDistinct: findDistinctProps,\n          })) as any;\n        },\n\n        findGlobal: async (findGlobalProps) => {\n          return (await service.db.bindings.finds.findGlobal({\n            service: service,\n            incomingFindGlobal: findGlobalProps,\n          })) as any;\n        },\n\n        findVersions: async (findVersionsProps) => {\n          return (await service.db.bindings.finds.findVersions({\n            service: service,\n            incomingFindVersions: findVersionsProps,\n          })) as any;\n        },\n\n        findGlobalVersions: async (findGlobalVersionsProps) => {\n          return (await service.db.bindings.finds.findGlobalVersions({\n            service: service,\n            incomingFindGlobalVersions: findGlobalVersionsProps,\n          })) as any;\n        },\n\n        // Delete\n        deleteOne: async (deleteOneProps) => {\n          return await service.db.bindings.deletes.deleteOne({\n            service: service,\n            incomingDeleteOne: deleteOneProps,\n          });\n        },\n\n        deleteMany: async (deleteManyProps) => {\n          return await service.db.bindings.deletes.deleteMany({\n            service: service,\n            incomingDeleteMany: deleteManyProps,\n          });\n        },\n\n        deleteVersions: async (deleteVersionsProps) => {\n          const result = await service.db.bindings.deletes.deleteVersions({\n            service: service,\n            incomingDeleteVersions: deleteVersionsProps,\n          });\n\n          // Clear the recent version ID after cleanup is complete\n          service.system.clearRecentVersionId();\n\n          return result;\n        },\n\n        // Update\n        updateOne: async (updateOneProps) => {\n          return await service.db.bindings.updates.updateOne({\n            service: service,\n            incomingUpdateOne: updateOneProps,\n          });\n        },\n\n        updateMany: async (updateManyProps) => {\n          return await service.db.bindings.updates.updateMany({\n            service: service,\n            incomingUpdateMany: updateManyProps,\n          });\n        },\n\n        updateGlobal: (async (updateGlobalProps) => {\n          return await service.db.bindings.updates.updateGlobal({\n            service: service,\n            incomingUpdateGlobal: updateGlobalProps,\n          });\n        }) as UpdateGlobal,\n\n        updateVersion: (async (updateVersionProps) => {\n          return await service.db.bindings.updates.updateVersion({\n            service: service,\n            incomingUpdateVersion: updateVersionProps,\n          });\n        }) as UpdateVersion,\n\n        updateGlobalVersion: (async (updateGlobalVersionProps) => {\n          return await service.db.bindings.updates.updateGlobalVersion({\n            service: service,\n            incomingUpdateGlobalVersion: updateGlobalVersionProps,\n          });\n        }) as UpdateGlobalVersion,\n\n        updateJobs: async (updateJobsProps) => {\n          return await service.db.bindings.updates.updateJobs({\n            service: service,\n            incomingUpdateJobs: updateJobsProps,\n          });\n        },\n\n        // Upsert\n        upsert: async (upsertProps) => {\n          return await service.db.bindings.upserts.upsert({\n            service: service,\n            incomingUpsert: upsertProps,\n          });\n        },\n\n        // Query Drafts\n        queryDrafts: async (queryDraftsProps) => {\n          return (await service.db.bindings.drafts.queryDrafts({\n            service: service,\n            incomingQueryDrafts: queryDraftsProps,\n          })) as PaginatedDocs;\n        },\n\n        // Migration Functions\n        migrate: async (migrateProps) => {\n          return await service.db.bindings.migrations.migrate({\n            service: service,\n            incomingMigrate: migrateProps,\n          });\n        },\n\n        migrateDown: async () => {\n          return await service.db.bindings.migrations.migrateDown({\n            service: service,\n          });\n        },\n\n        migrateFresh: async (migrateFreshProps) => {\n          return await service.db.bindings.migrations.migrateFresh({\n            service: service,\n          });\n        },\n\n        migrateRefresh: async () => {\n          return await service.db.bindings.migrations.migrateRefresh({\n            service: service,\n          });\n        },\n\n        migrateReset: async () => {\n          return await service.db.bindings.migrations.migrateReset({\n            service: service,\n          });\n        },\n\n        migrateStatus: async () => {\n          return await service.db.bindings.migrations.migrateStatus({\n            service: service,\n          });\n        },\n      });\n    },\n  } satisfies convexAdapter;\n}\n"]}